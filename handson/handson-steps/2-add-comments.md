## この章でやること

Visual Studio Code上で、ソースコードコメントを付与してみましょう！

## 手順

### コード補完とインラインチャットで `PostController.java` を編集

1. エディタで `src/main/java/com/example/handson/controller/PostController.java` を開きます。 :bulb: Win: Ctrl+p, Mac: Cmd+p でファイル名検索ができます。
1. クラス定義のすぐ上の行（12行目あたり）で `/**` と入力しTabキーを押します。GitHub Copilotのコード補完によりソースコードコメントが入力されることを確認します。
1. GitHub Copilotとのインラインチャットで明確に指示を出し、クラスやメソッドにソースコードコメントを付与します。 :bulb: Win: Ctrl+i, Mac: Cmd+i でインラインチャットが開きます。
    - JavaDocコメントを日本語で追加してください。
    - `/doc` 日本語で追加してください。 :bulb: `/` でよく使う操作を簡単に依頼できるコマンドが入力できます。

### Custom Instructions を作成

1. エディタで `handson/.github/copilot-instructions.md` を開きます。
1. 次の内容をファイル内に記載します。
```markdown
# GitHub Copilot - Spring Boot APIカスタム命令

## コード生成全般

- **シンプルさと可読性を優先**: 複雑な記述よりも簡潔で理解しやすいコードを生成する
- **モダンなJavaコーディングスタイル**: Java 21の機能（レコード、テキストブロック、var）を活用したシンプルなコードを書く
- **コメント**:
  - すべてのクラスとメソッドにJacaDocコメントを追加 
  - コードの重要な部分には簡潔な説明コメントを追加する
  - コメントは日本語で記述する
- **命名規則**: 
  - 直感的な名前（何をするかが名前から推測できる）
  - クラス名はPascalCase
  - メソッド名とフィールド名はcamelCase
  - 定数はSNAKE_CASEで記述

## Spring Boot実装のポイント

- **シンプルな層分離**: コントローラー、サービス、リポジトリの基本的な層分離を使ったコード構造
- **RESTful API設計**: GET/POST/PUT/DELETEを適切に使ったREST APIエンドポイント
- **例外処理**: @ExceptionHandlerを使った分かりやすいエラーレスポンス
- **コンストラクタ注入**: @Autowiredアノテーションよりもコンストラクタ注入を使用

## テストコード

- **テスト階層構造**: ユニット、統合、エンドツーエンドテストの適切な組み合わせ
- **モック戦略**: サービスとリポジトリの依存関係を効果的にモック化
- **テストデータ**: テストフィクスチャとファクトリメソッドを使った効率的なテストデータ作成
- **テストカバレッジ**: すべてのビジネスロジックとエッジケースをカバーするテスト
- **テストメソッド命名規約**: 
  - 「何をテストするか_どんな条件で_どんな結果を期待するか」形式で命名
  - 例: createUser_WithValidData_ShouldReturnCreatedUser
  - 日本語コメントでテストの意図を明確に説明

## API設計とデータ処理

- **RESTfulリソース設計**: リソース指向の一貫したエンドポイント構造（例: /api/v1/products/{id}）
- **適切なHTTPステータスコード**: 201 Created, 400 Bad Request, 404 Not Found, 409 Conflictなど
- **ページネーションと並べ替え**: Pageableを使った効率的なデータ取得と並べ替え機能
- **フィルタリング**: 複数条件でのフィルタリングに対応したクエリ設計

## セキュリティと堅牢性

- **入力検証**: Bean Validation（@NotNull, @Size, @Patternなど）を使った徹底的な入力検証
- **例外処理**: 詳細なエラーコードと説明を含むグローバル例外ハンドラー
- **監査ログ**: 重要な操作（作成・更新・削除）のログ記録
- **APIレート制限**: 過剰なリクエストからの保護

## パフォーマンス最適化

- **効率的なデータアクセス**: N+1問題の回避とJPQLの最適化
- **キャッシュ戦略**: @Cacheableを使った適切なキャッシュ実装
- **非同期処理**: @Asyncを使った長時間実行タスクの処理
- **バルク処理**: 大量データの効率的な処理方法
```

### Copilot Chat と Agent Mode で `Post.java` を編集

1. エディタで `src/main/java/com/example/handson/model/Post.java` を開きます。
1. Copilot Chatのウィンドウでソースコードコメントについて相談しながら付与します。該当Javaファイルがコンテキストに含まれていることを確認してください。ファイルを開くか、チャットウィンドウへのドラッグアンドドロップで設定できます。前の手順で行ったチャット変数 `#file` の使用も可能です。 :bulb: コンテキストの含め方の違いは口頭で補足します。
    - 初めてソースコードを見た人でも分かりやすいよう、このクラスにコメントを付与したいです。どのような内容が良いですか？
    - このクラスにJavaDocコメントを日本語で付与してください。
1. Copilot Chatの回答をファイルに反映させます。 :bulb: 反映のさせ方にはいくつか種類があります。

## 余裕がある方向けの追加ワーク

1. Copilot を使ってコミットコメントを書き、差分をGitにコミットします（専用ブランチの作成をオススメします）。Gitタブで✨️アイコンをクリックするとコミットコメントが自動生成されます。
    ![git-gommit](images/2-git-commit.png)
1. アプリケーションを実行します。手順は[アプリケーションのREADME](https://github.com/ihcomega56/GHCP-intro-handson2504/blob/main/handson/.gitattributes)にあります。